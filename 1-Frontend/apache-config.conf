<VirtualHost *:80>
    ServerName refcheck.local
    ServerAlias localhost
    
    DocumentRoot /var/www/html
    
    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Rewrite rules
        RewriteEngine On
        RewriteBase /
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^(.*)$ index.php [QSA,L]
    </Directory>
    
    # Alias pour les ressources statiques
    Alias /uploads /var/www/html/uploads
    <Directory /var/www/html/uploads>
        Options Indexes FollowSymLinks
        Require all granted
    </Directory>
    
    # Bloquer l'accès aux fichiers sensibles
    <FilesMatch "config\.php|\.env|\.htaccess|\.log">
        Order Deny,Allow
        Deny from all
    </FilesMatch>
    
    # Sécurité headers
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-Content-Type-Options "nosniff"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Compression gzip
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>
    
    # Cache control
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
    </IfModule>
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/refcheck-error.log
    CustomLog ${APACHE_LOG_DIR}/refcheck-access.log combined
    
    # PHP Settings
    php_flag display_errors On
    php_value upload_max_filesize 50M
    php_value post_max_size 50M
    php_value max_execution_time 300
    php_value max_input_time 300
</VirtualHost>
